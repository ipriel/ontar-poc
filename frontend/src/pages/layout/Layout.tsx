import { Outlet, Link, NavLink, useNavigate, useLocation } from "react-router-dom";
import { Settings24Filled as SettingsIcon, ChevronDown24Regular as ChevronDownIcon, ChevronUp24Regular as ChevronUpIcon } from "@fluentui/react-icons";
import { Stack } from "@fluentui/react";
import { useEffect, useState, useMemo, useContext } from "react";
import { format, intervalToDuration } from "date-fns";
import classNames from "classnames";

import ProfilePic from "../../assets/profile.png";
import styles from "./Layout.module.css";
import { UserPuck } from "../../components/UserPuck";
import { ShowIf, Else } from "../../components/ShowIf";
import { registerSVGs, SVG } from "../../components/SVG";
import { isDefined } from "../../lib";
import svgCollection from "./Layout.data";
import { WebsocketContext, useLastEventQuery } from "../../lib";

registerSVGs(svgCollection);

const Layout = () => {
    const [isSidebarExpanded, setIsSidebarExpanded] = useState<boolean>(true);
    const navigate = useNavigate();
    let location = useLocation();
    useContext(WebsocketContext);
    const {data: serverEvent} = useLastEventQuery();
    const {isLiveAttack, attackStartDate, riskScore} = useMemo(()=>{
        if(isDefined(serverEvent)) { 
            return {
                isLiveAttack: serverEvent.isLiveAttack,
                attackStartDate: serverEvent.firstEvent?.startTime, 
                riskScore: serverEvent.firstEvent?.securityScore
            };
        }

        return {isLiveAttack: false, attackStartDate: undefined, riskScore: undefined};
    }, [serverEvent]);

    const attackDuration = useMemo(() => {
        if (!isDefined(attackStartDate)) return undefined;

        const dur = intervalToDuration({
            start: attackStartDate ?? new Date(),
            end: new Date()
        });
        const leftPad = (num: number | undefined) => String(num || 0).padStart(2, '0');

        return `${dur.days ? dur.days + ' days ' : ''}${leftPad(dur.hours)}:${leftPad(dur.minutes)}:${leftPad(dur.seconds)}`;
    }, [attackStartDate]);

    const formattedStartDate = useMemo(() => {
        if (!isDefined(attackStartDate)) return undefined;

        return format(attackStartDate, "d.M.yyyy h:mmaa");
    }, [attackStartDate]);

    useEffect(() => {
        if (!isLiveAttack && location.pathname === "/home") {
            navigate("/");
        }
        else if (isLiveAttack && location.pathname != "/home") {
            navigate("/home");
        }
    }, [isLiveAttack]);

    return (
        <Stack className={styles.layout} data-sidebar={isSidebarExpanded}>
            <div className={styles.sidebarLayout} style={{ width: isSidebarExpanded ? "300px" : "auto" }}>
                <div className={styles.sidebarHeaderContainer}>
                    <ShowIf condition={isSidebarExpanded}>
                        <Link to="/" className={styles.sidebarLogoContainer}>
                            <SVG svgName="logo_wide" />
                        </Link>
                        <svg className={styles.sidebarToggle} onClick={() => setIsSidebarExpanded(false)} width="21" height="15" viewBox="0 0 21 15" fill="#706E86" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1.05835 7.36816H19.0583M1.05835 1.36816H19.0583M1.05835 13.3682H19.0583" stroke="#706E86" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <Else>
                            <SVG
                                className={styles.sidebarToggle}
                                onClick={() => setIsSidebarExpanded(true)}
                                svgName="logo_image"
                            />
                        </Else>
                    </ShowIf>
                </div>
                <div className={styles.companyDropdownContainer}>
                    <svg className={styles.companyDropdownIcon} width="19" height="21" viewBox="0 0 19 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M6.21981 0.368165H11.8969C12.424 0.368149 12.8788 0.368135 13.2534 0.398737C13.6487 0.431038 14.0419 0.502354 14.4203 0.695148C14.9848 0.982768 15.4438 1.44171 15.7314 2.0062C15.9242 2.38458 15.9955 2.77779 16.0278 3.17314C16.0584 3.54768 16.0584 4.00253 16.0584 4.52962V18.3682H17.0583C17.6106 18.3682 18.0583 18.8159 18.0583 19.3682C18.0583 19.9204 17.6106 20.3682 17.0583 20.3682H1.05835C0.506065 20.3682 0.0583496 19.9204 0.0583496 19.3682C0.0583496 18.8159 0.506065 18.3682 1.05835 18.3682H2.05835L2.05835 4.52962C2.05833 4.00247 2.05832 3.54771 2.08892 3.17314C2.12122 2.77779 2.19254 2.38458 2.38533 2.0062C2.67295 1.44171 3.13189 0.982768 3.69638 0.695148C4.07476 0.502354 4.46798 0.431038 4.86332 0.398737C5.23788 0.368135 5.69269 0.368149 6.21981 0.368165ZM5.05835 5.36817C5.05835 4.81588 5.50606 4.36817 6.05835 4.36817H12.0583C12.6106 4.36817 13.0583 4.81588 13.0583 5.36817C13.0583 5.92045 12.6106 6.36817 12.0583 6.36817H6.05835C5.50606 6.36817 5.05835 5.92045 5.05835 5.36817ZM5.05835 9.36817C5.05835 8.81588 5.50606 8.36817 6.05835 8.36817H12.0583C12.6106 8.36817 13.0583 8.81588 13.0583 9.36817C13.0583 9.92045 12.6106 10.3682 12.0583 10.3682H6.05835C5.50606 10.3682 5.05835 9.92045 5.05835 9.36817ZM6.05835 12.3682C5.50606 12.3682 5.05835 12.8159 5.05835 13.3682C5.05835 13.9205 5.50606 14.3682 6.05835 14.3682H12.0583C12.6106 14.3682 13.0583 13.9205 13.0583 13.3682C13.0583 12.8159 12.6106 12.3682 12.0583 12.3682H6.05835Z" fill="#C792FF" />
                    </svg>
                    <p className={styles.companyDropdownText}>EverBank</p>
                    <ChevronDownIcon className={styles.companyDropdownChevron} />
                </div>
                <ul className={styles.menuList}>
                    <li className={classNames(styles.menuListItem, { [styles.hiddenMenuListItem]: !isLiveAttack })}>
                        <div className={styles.menuListItemIcon}>
                            <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11.0583 3.423C10.7626 3.45566 10.4713 3.50262 10.1853 3.56314C9.64494 3.67745 9.11425 3.3321 8.99994 2.79178C8.88563 2.25145 9.23098 1.72077 9.7713 1.60645C10.5099 1.45018 11.2751 1.36816 12.0583 1.36816C12.8416 1.36816 13.6068 1.45018 14.3454 1.60645C14.8857 1.72077 15.2311 2.25145 15.1168 2.79178C15.0024 3.3321 14.4718 3.67745 13.9314 3.56314C13.6454 3.50262 13.3541 3.45566 13.0583 3.423V7.46818C13.6967 7.59776 14.2909 7.84895 14.8157 8.19652L17.676 5.3362C17.4461 5.1523 17.2071 4.97944 16.9596 4.81842C16.4967 4.51722 16.3656 3.89777 16.6668 3.43485C16.968 2.97194 17.5875 2.84085 18.0504 3.14206C19.3417 3.9823 20.4454 5.08612 21.2854 6.37761C21.5866 6.84057 21.4554 7.46 20.9924 7.76113C20.5294 8.06226 19.91 7.93107 19.6089 7.46811C19.4476 7.22018 19.2745 6.98067 19.0902 6.7504L16.2299 9.61072C16.5775 10.1355 16.8287 10.7298 16.9583 11.3682H21.0035C20.9708 11.0723 20.9239 10.781 20.8633 10.4949C20.749 9.95462 21.0944 9.42393 21.6347 9.3096C22.175 9.19528 22.7057 9.54062 22.82 10.0809C22.9763 10.8196 23.0583 11.5849 23.0583 12.3682C23.0583 13.1512 22.9764 13.9161 22.8202 14.6545C22.7059 15.1948 22.1753 15.5402 21.6349 15.426C21.0946 15.3117 20.7492 14.781 20.8635 14.2407C20.924 13.9548 20.9709 13.6637 21.0035 13.3682H16.9583C16.8288 14.0065 16.5776 14.6007 16.23 15.1255L19.0903 17.9858C19.2736 17.7568 19.4459 17.5186 19.6064 17.272C19.9078 16.8092 20.5273 16.6784 20.9901 16.9797C21.4529 17.2811 21.5838 17.9006 21.2824 18.3634C20.4422 19.6537 19.3388 20.7564 18.048 21.5958C17.585 21.8969 16.9656 21.7657 16.6645 21.3027C16.3634 20.8397 16.4947 20.2203 16.9577 19.9192C17.2059 19.7578 17.4456 19.5845 17.6761 19.4001L14.8158 16.5397C14.291 16.8873 13.6967 17.1386 13.0583 17.2681V21.3133C13.3532 21.2808 13.6435 21.234 13.9287 21.1738C14.4691 21.0596 14.9997 21.4051 15.1138 21.9455C15.228 22.4858 14.8824 23.0164 14.3421 23.1306C13.6045 23.2864 12.8404 23.3682 12.0583 23.3682C11.2734 23.3682 10.5065 23.2858 9.76639 23.1288C9.22612 23.0143 8.88101 22.4834 8.99557 21.9432C9.11013 21.4029 9.64098 21.0578 10.1813 21.1723C10.4686 21.2333 10.7612 21.2805 11.0583 21.3133V17.2681C10.42 17.1386 9.82572 16.8873 9.30091 16.5397L6.44059 19.4C6.67059 19.5841 6.90981 19.757 7.15743 19.9181C7.62036 20.2193 7.75148 20.8388 7.45029 21.3017C7.14911 21.7646 6.52967 21.8957 6.06674 21.5946C4.77722 20.7556 3.67485 19.6538 2.8352 18.3648C2.53376 17.902 2.66455 17.2825 3.12732 16.981C3.59008 16.6796 4.20959 16.8104 4.51103 17.2732C4.67136 17.5193 4.84341 17.7571 5.02638 17.9858L7.88671 15.1255C7.53914 14.6007 7.28795 14.0065 7.15837 13.3682H3.11319C3.14585 13.664 3.19282 13.9553 3.25336 14.2414C3.36768 14.7817 3.02234 15.3124 2.48201 15.4267C1.94169 15.541 1.411 15.1957 1.29667 14.6554C1.14038 13.9167 1.05835 13.1515 1.05835 12.3682C1.05835 11.5837 1.14062 10.8174 1.29736 10.0777C1.41185 9.53741 1.94265 9.19223 2.48293 9.30672C3.02322 9.4212 3.3684 9.952 3.25392 10.4923C3.19311 10.7792 3.14595 11.0714 3.11319 11.3682H7.15837C7.28796 10.7298 7.53917 10.1355 7.88678 9.61072L5.02646 6.7504C4.84242 6.98044 4.66943 7.2197 4.5083 7.46736C4.20712 7.9303 3.58768 8.06143 3.12475 7.76025C2.66181 7.45907 2.53068 6.83963 2.83186 6.3767C3.67169 5.08581 4.77491 3.98245 6.06568 3.14246C6.52858 2.84122 7.14803 2.97227 7.44927 3.43516C7.75051 3.89806 7.61947 4.51751 7.15657 4.81875C6.90929 4.97967 6.6704 5.15242 6.44069 5.3362L9.30101 8.19652C9.82581 7.84895 10.42 7.59776 11.0583 7.46818V3.423Z" fill="currentColor" />
                            </svg>
                        </div>
                        <NavLink to="/home" className={styles.menuListItemText}><span className={styles.menuListItemEmphasis}>Live</span> Attack</NavLink>
                    </li>
                    <li className={styles.menuListItem}>
                        <div className={styles.menuListItemIcon}>
                            <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3.05835 11.3682C3.05835 9.15902 4.84921 7.36816 7.05835 7.36816H17.0583C19.2675 7.36816 21.0583 9.15903 21.0583 11.3682V15.3682C21.0583 17.5773 19.2675 19.3682 17.0583 19.3682H14.4449C13.7651 19.3682 13.0965 19.5414 12.5023 19.8715L8.00835 22.3682V19.3682H7.05835C4.84921 19.3682 3.05835 17.5773 3.05835 15.3682V11.3682Z" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
                                <circle cx="8.05835" cy="13.3682" r="2" fill="#1F1F25" />
                                <circle cx="16.0583" cy="13.3682" r="2" fill="#1F1F25" />
                                <circle cx="12.0583" cy="3.36816" r="1" stroke="currentColor" stroke-width="2" />
                                <path d="M21.0583 11.3682H22.0583C23.1629 11.3682 24.0583 12.2636 24.0583 13.3682C24.0583 14.4727 23.1629 15.3682 22.0583 15.3682H21.0583V11.3682Z" fill="currentColor" />
                                <path d="M0.0583496 13.3682C0.0583496 12.2636 0.95378 11.3682 2.05835 11.3682H3.05835V15.3682H2.05835C0.95378 15.3682 0.0583496 14.4727 0.0583496 13.3682Z" fill="currentColor" />
                            </svg>
                        </div>
                        <NavLink to="/chat" className={classNames(styles.menuListItemText, { 'active': location.pathname == "/" })}>Ask Chatbot</NavLink>
                    </li>
                    <li className={styles.menuListItem}>
                        <div className={styles.menuListItemIcon}>
                            <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M2.62646 0.368167C3.9144 0.368326 5.20485 0.368325 6.49025 0.368167C6.74264 0.368137 6.98843 0.368107 7.19658 0.385114C7.42518 0.403791 7.69491 0.447859 7.96634 0.586156C8.34266 0.777903 8.64862 1.08386 8.84037 1.46019C8.97866 1.73161 9.02273 2.00135 9.04141 2.22994C9.05842 2.4381 9.05839 2.6839 9.05836 2.93629V6.80005C9.05839 7.05244 9.05842 7.29824 9.04141 7.5064C9.02273 7.73499 8.97866 8.00473 8.84037 8.27615C8.64862 8.65247 8.34266 8.95844 7.96634 9.15018C7.69491 9.28848 7.42518 9.33255 7.19658 9.35122C6.98842 9.36823 6.74262 9.3682 6.49024 9.36817H2.62647C2.37409 9.3682 2.12829 9.36823 1.92012 9.35122C1.69153 9.33255 1.4218 9.28848 1.15037 9.15018C0.77405 8.95844 0.468088 8.65247 0.276342 8.27615C0.138044 8.00473 0.0939768 7.73499 0.0753 7.5064C0.0582927 7.29824 0.0583222 7.05245 0.0583521 6.80007C0.0583534 6.78945 0.0583547 6.77881 0.0583547 6.76817V2.96817C0.0583547 2.95753 0.0583534 2.94689 0.0583521 2.93627C0.0583222 2.68389 0.0582927 2.4381 0.0753 2.22994C0.0939768 2.00135 0.138044 1.73161 0.276342 1.46019C0.468088 1.08386 0.77405 0.777903 1.15037 0.586156C1.4218 0.447859 1.69153 0.403791 1.92012 0.385114C2.12828 0.368107 2.37407 0.368137 2.62646 0.368167Z" fill="currentColor" />
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M2.62646 11.3682C3.9144 11.3683 5.20485 11.3683 6.49025 11.3682C6.74264 11.3681 6.98843 11.3681 7.19658 11.3851C7.42518 11.4038 7.69491 11.4479 7.96634 11.5862C8.34266 11.7779 8.64862 12.0839 8.84037 12.4602C8.97866 12.7316 9.02273 13.0013 9.04141 13.2299C9.05842 13.4381 9.05839 13.6839 9.05836 13.9363V17.8C9.05839 18.0524 9.05842 18.2982 9.04141 18.5064C9.02273 18.735 8.97866 19.0047 8.84037 19.2761C8.64862 19.6525 8.34266 19.9584 7.96634 20.1502C7.69491 20.2885 7.42518 20.3325 7.19658 20.3512C6.98842 20.3682 6.74262 20.3682 6.49024 20.3682H2.62647C2.37409 20.3682 2.12829 20.3682 1.92012 20.3512C1.69153 20.3325 1.4218 20.2885 1.15037 20.1502C0.77405 19.9584 0.468088 19.6525 0.276342 19.2761C0.138044 19.0047 0.0939768 18.735 0.0753 18.5064C0.0582927 18.2982 0.0583222 18.0525 0.0583521 17.8001C0.0583534 17.7894 0.0583547 17.7788 0.0583547 17.7682V13.9682C0.0583547 13.9575 0.0583534 13.9469 0.0583521 13.9363C0.0583222 13.6839 0.0582927 13.4381 0.0753 13.2299C0.0939768 13.0013 0.138044 12.7316 0.276342 12.4602C0.468088 12.0839 0.77405 11.7779 1.15037 11.5862C1.4218 11.4479 1.69153 11.4038 1.92012 11.3851C2.12828 11.3681 2.37407 11.3681 2.62646 11.3682Z" fill="currentColor" />
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M13.6265 0.368167C14.9144 0.368326 16.2049 0.368325 17.4903 0.368167C17.7426 0.368137 17.9884 0.368107 18.1966 0.385114C18.4252 0.403791 18.6949 0.447859 18.9663 0.586156C19.3427 0.777903 19.6486 1.08386 19.8404 1.46019C19.9787 1.73161 20.0227 2.00135 20.0414 2.22994C20.0584 2.4381 20.0584 2.6839 20.0584 2.93629V6.80005C20.0584 7.05244 20.0584 7.29824 20.0414 7.5064C20.0227 7.73499 19.9787 8.00473 19.8404 8.27615C19.6486 8.65247 19.3427 8.95844 18.9663 9.15018C18.6949 9.28848 18.4252 9.33255 18.1966 9.35122C17.9884 9.36823 17.7426 9.3682 17.4902 9.36817H13.6265C13.3741 9.3682 13.1283 9.36823 12.9201 9.35122C12.6915 9.33255 12.4218 9.28848 12.1504 9.15018C11.774 8.95844 11.4681 8.65247 11.2763 8.27615C11.138 8.00473 11.094 7.73499 11.0753 7.5064C11.0583 7.29824 11.0583 7.05245 11.0584 6.80007C11.0584 6.78945 11.0584 6.77881 11.0584 6.76817V2.96817C11.0584 2.95753 11.0584 2.94689 11.0584 2.93627C11.0583 2.68389 11.0583 2.4381 11.0753 2.22994C11.094 2.00135 11.138 1.73161 11.2763 1.46019C11.4681 1.08386 11.774 0.777903 12.1504 0.586156C12.4218 0.447859 12.6915 0.403791 12.9201 0.385114C13.1283 0.368107 13.3741 0.368137 13.6265 0.368167Z" fill="currentColor" />
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M13.6265 11.3682C14.9144 11.3683 16.2049 11.3683 17.4903 11.3682C17.7426 11.3681 17.9884 11.3681 18.1966 11.3851C18.4252 11.4038 18.6949 11.4479 18.9663 11.5862C19.3427 11.7779 19.6486 12.0839 19.8404 12.4602C19.9787 12.7316 20.0227 13.0013 20.0414 13.2299C20.0584 13.4381 20.0584 13.6839 20.0584 13.9363V17.8C20.0584 18.0524 20.0584 18.2982 20.0414 18.5064C20.0227 18.735 19.9787 19.0047 19.8404 19.2761C19.6486 19.6525 19.3427 19.9584 18.9663 20.1502C18.6949 20.2885 18.4252 20.3325 18.1966 20.3512C17.9884 20.3682 17.7426 20.3682 17.4902 20.3682H13.6265C13.3741 20.3682 13.1283 20.3682 12.9201 20.3512C12.6915 20.3325 12.4218 20.2885 12.1504 20.1502C11.774 19.9584 11.4681 19.6525 11.2763 19.2761C11.138 19.0047 11.094 18.735 11.0753 18.5064C11.0583 18.2982 11.0583 18.0525 11.0584 17.8001C11.0584 17.7894 11.0584 17.7788 11.0584 17.7682V13.9682C11.0584 13.9575 11.0584 13.9469 11.0584 13.9363C11.0583 13.6839 11.0583 13.4381 11.0753 13.2299C11.094 13.0013 11.138 12.7316 11.2763 12.4602C11.4681 12.0839 11.774 11.7779 12.1504 11.5862C12.4218 11.4479 12.6915 11.4038 12.9201 11.3851C13.1283 11.3681 13.3741 11.3681 13.6265 11.3682Z" fill="currentColor" />
                            </svg>
                        </div>
                        <p className={styles.menuListItemText}>Dashboard</p>
                    </li>
                    <li className={styles.menuListItem}>
                        <div className={styles.menuListItemIcon}>
                            <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M0.0583496 11.3682C0.0583496 5.29303 4.98322 0.368164 11.0583 0.368164C17.1335 0.368164 22.0583 5.29303 22.0583 11.3682C22.0583 17.4433 17.1335 22.3682 11.0583 22.3682C4.98322 22.3682 0.0583496 17.4433 0.0583496 11.3682ZM14.0583 11.3682C14.0583 10.8159 14.5061 10.3682 15.0583 10.3682H19.0583C19.6106 10.3682 20.0583 10.8159 20.0583 11.3682C20.0583 11.9204 19.6106 12.3682 19.0583 12.3682H15.0583C14.5061 12.3682 14.0583 11.9204 14.0583 11.3682ZM3.05835 10.3682C2.50606 10.3682 2.05835 10.8159 2.05835 11.3682C2.05835 11.9204 2.50606 12.3682 3.05835 12.3682H7.05835C7.61063 12.3682 8.05835 11.9204 8.05835 11.3682C8.05835 10.8159 7.61063 10.3682 7.05835 10.3682H3.05835ZM11.0583 2.36816C11.6106 2.36816 12.0583 2.81588 12.0583 3.36816V7.36816C12.0583 7.92045 11.6106 8.36816 11.0583 8.36816C10.5061 8.36816 10.0583 7.92045 10.0583 7.36816V3.36816C10.0583 2.81588 10.5061 2.36816 11.0583 2.36816ZM12.0583 15.3682C12.0583 14.8159 11.6106 14.3682 11.0583 14.3682C10.5061 14.3682 10.0583 14.8159 10.0583 15.3682V19.3682C10.0583 19.9204 10.5061 20.3682 11.0583 20.3682C11.6106 20.3682 12.0583 19.9204 12.0583 19.3682V15.3682Z" fill="currentColor" />
                            </svg>
                        </div>
                        <p className={styles.menuListItemText}>Business Continuity</p>
                    </li>
                    <li className={styles.menuListItem}>
                        <div className={styles.menuListItemIcon}>
                            <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4.21981 0.368165H15.8969C16.424 0.368148 16.8788 0.368133 17.2534 0.398736C17.6487 0.431037 18.0419 0.502353 18.4203 0.695147C18.9848 0.982767 19.4437 1.44171 19.7314 2.0062C19.9242 2.38457 19.9955 2.77779 20.0278 3.17314C20.0584 3.5477 20.0584 4.00245 20.0584 4.52958V5.03589C20.0584 5.18699 20.0584 5.26254 20.0381 5.33154C20.0201 5.39265 19.9907 5.44976 19.9513 5.49981C19.9068 5.55633 19.8453 5.60013 19.7222 5.68773L12.1675 11.0632L9.22937 8.12506C9.15743 8.05306 9.06926 7.96483 8.98473 7.89217C8.88496 7.80642 8.73841 7.69549 8.53804 7.6191C8.27396 7.51842 7.98681 7.49439 7.70967 7.54978C7.49939 7.59181 7.33644 7.67684 7.22381 7.74482C7.12838 7.80241 7.02678 7.87476 6.94388 7.9338L1.32215 11.9339C0.913665 12.2245 0.70942 12.3699 0.539186 12.3633C0.390969 12.3576 0.252928 12.2864 0.162366 12.169C0.0583509 12.0341 0.0583506 11.7834 0.0583506 11.282V4.5296C0.0583315 4.00246 0.0583162 3.54771 0.0889196 3.17314C0.121221 2.77779 0.192536 2.38457 0.385331 2.0062C0.672952 1.44171 1.13189 0.982767 1.69638 0.695147C2.07476 0.502353 2.46798 0.431037 2.86332 0.398736C3.23789 0.368133 3.69267 0.368148 4.21981 0.368165Z" fill="currentColor" />
                                <path d="M0.0583506 15.7004C0.0583506 15.5493 0.0583508 15.4737 0.0786199 15.4047C0.0965686 15.3436 0.126025 15.2865 0.165404 15.2364C0.209875 15.1799 0.271431 15.1361 0.394546 15.0485L7.94907 9.67319L10.8872 12.6113C10.9591 12.6833 11.0473 12.7715 11.1318 12.8442C11.2316 12.9299 11.3781 13.0409 11.5785 13.1173C11.8426 13.2179 12.1297 13.242 12.4069 13.1866C12.6172 13.1446 12.7801 13.0595 12.8927 12.9915C12.9882 12.934 13.0897 12.8616 13.1726 12.8026L18.7945 8.80237C19.203 8.51172 19.4073 8.36639 19.5775 8.37292C19.7257 8.3786 19.8638 8.4498 19.9543 8.56727C20.0584 8.70219 20.0584 8.95286 20.0584 9.45421V16.2067C20.0584 16.7338 20.0584 17.1886 20.0278 17.5632C19.9955 17.9585 19.9242 18.3518 19.7314 18.7301C19.4437 19.2946 18.9848 19.7536 18.4203 20.0412C18.0419 20.234 17.6487 20.3053 17.2534 20.3376C16.8788 20.3682 16.4241 20.3682 15.8969 20.3682H4.21978C3.69264 20.3682 3.23789 20.3682 2.86332 20.3376C2.46798 20.3053 2.07476 20.234 1.69638 20.0412C1.13189 19.7536 0.672952 19.2946 0.385331 18.7301C0.192536 18.3518 0.121221 17.9585 0.0889196 17.5632C0.0583162 17.1886 0.0583315 16.7339 0.0583506 16.2067V15.7004Z" fill="currentColor" />
                            </svg>
                        </div>
                        <p className={styles.menuListItemText}>Live Report</p>
                    </li>
                    <li className={styles.menuListItem}>
                        <div className={styles.menuListItemIcon}>
                            <svg width="20" height="23" viewBox="0 0 20 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6.55274 0.367793L6.51776 0.367547C6.3909 0.366294 6.12779 0.363696 5.87823 0.449775C5.66804 0.522274 5.4766 0.640591 5.31776 0.796166C5.12916 0.980886 5.01381 1.21738 4.9582 1.33141L4.94278 1.36281L0.72863 9.79109C0.645305 9.95762 0.555079 10.138 0.492975 10.2969C0.427865 10.4636 0.333457 10.7487 0.383443 11.087C0.443749 11.4952 0.669518 11.8605 1.00762 12.097C1.28787 12.293 1.58507 12.336 1.76328 12.3523C1.93326 12.3679 2.1349 12.3678 2.32112 12.3678L7.21429 12.3678L4.60049 21.0804C4.46788 21.5225 4.655 21.9979 5.05336 22.2309C5.45171 22.464 5.95781 22.3941 6.27816 22.0619L18.4969 9.39065C18.6802 9.20064 18.8615 9.01271 18.9943 8.84788C19.1143 8.69895 19.3504 8.38983 19.3783 7.96644C19.4097 7.49116 19.2134 7.02925 18.8495 6.72189C18.5254 6.44808 18.139 6.40346 17.9484 6.38649C17.7376 6.36771 17.4765 6.36775 17.2125 6.36779L11.5013 6.36779L13.2446 1.71892C13.3598 1.41182 13.3171 1.06777 13.1302 0.798198C12.9434 0.528624 12.6363 0.367793 12.3083 0.367793H6.55274Z" fill="currentColor" />
                            </svg>
                        </div>
                        <p className={styles.menuListItemText}>Threat Analytics</p>
                    </li>
                    <li className={styles.menuListItem}>
                        <div className={styles.menuListItemIcon}>
                            <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4.21981 0.368165H15.8969C16.424 0.368149 16.8788 0.368135 17.2534 0.398737C17.6487 0.431038 18.0419 0.502354 18.4203 0.695148C18.9848 0.982768 19.4438 1.44171 19.7314 2.0062C19.9242 2.38458 19.9955 2.77779 20.0278 3.17314C20.0584 3.54771 20.0584 4.00246 20.0584 4.5296L20.0583 5.36817C20.0583 6.29447 19.0614 7.36817 17.3917 7.36817C15.7219 7.36817 14.725 6.29447 14.725 5.36817C14.725 4.81588 14.2773 4.36817 13.725 4.36817C13.1727 4.36817 12.725 4.81588 12.725 5.36817C12.725 6.29447 11.7281 7.36817 10.0584 7.36817C8.38861 7.36817 7.39168 6.29447 7.39168 5.36817C7.39168 4.81588 6.94397 4.36817 6.39168 4.36817C5.8394 4.36817 5.39168 4.81588 5.39168 5.36817C5.39168 6.29447 4.39476 7.36817 2.72502 7.36817C1.05527 7.36817 0.0583504 6.29447 0.0583504 5.36817V4.52958C0.0583341 4.00247 0.0583201 3.54769 0.0889224 3.17314C0.121223 2.77779 0.192539 2.38458 0.385333 2.0062C0.672954 1.44171 1.1319 0.982768 1.69638 0.695148C2.07476 0.502354 2.46798 0.431038 2.86332 0.398737C3.23788 0.368135 3.69269 0.368149 4.21981 0.368165Z" fill="currentColor" />
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M17.3917 9.36817C18.3421 9.36817 19.2775 9.1111 20.0584 8.65028V16.2067C20.0584 16.7339 20.0584 17.1886 20.0278 17.5632C19.9955 17.9585 19.9242 18.3518 19.7314 18.7301C19.4438 19.2946 18.9848 19.7536 18.4203 20.0412C18.0419 20.234 17.6487 20.3053 17.2534 20.3376C16.8788 20.3682 16.4241 20.3682 15.8969 20.3682H4.21979C3.69265 20.3682 3.23789 20.3682 2.86332 20.3376C2.46798 20.3053 2.07476 20.234 1.69638 20.0412C1.1319 19.7536 0.672954 19.2946 0.385333 18.7301C0.192539 18.3518 0.121223 17.9585 0.0889224 17.5632C0.0583201 17.1886 0.0583341 16.7339 0.0583504 16.2068V8.65028C0.839228 9.1111 1.77463 9.36817 2.72502 9.36817C4.13042 9.36817 5.50305 8.80602 6.39168 7.85417C7.28032 8.80602 8.65295 9.36817 10.0584 9.36817C11.4638 9.36817 12.8364 8.80602 13.725 7.85416C14.6137 8.80602 15.9863 9.36817 17.3917 9.36817ZM8.65835 12.3682H11.4584C12.0184 12.3682 12.2984 12.3682 12.5123 12.4772C12.7005 12.573 12.8535 12.726 12.9494 12.9142C13.0584 13.1281 13.0584 13.4081 13.0584 13.9682V18.3682H7.05835V13.9682C7.05835 13.4081 7.05835 13.1281 7.16734 12.9142C7.26322 12.726 7.4162 12.573 7.60436 12.4772C7.81827 12.3682 8.0983 12.3682 8.65835 12.3682Z" fill="currentColor" />
                            </svg>
                        </div>
                        <p className={styles.menuListItemText}>Marketplace</p>
                    </li>
                    <li className={styles.menuListItem}>
                        <div className={styles.menuListItemIcon}>
                            <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M14.3209 13.4993L13.1897 12.3679L10.927 14.6304L9.79589 13.4993L12.0584 11.2366L10.927 10.1055L8.66453 12.3679L7.53317 11.2366L5.26997 13.4993C3.90197 14.868 3.73253 16.9798 4.76141 18.5328L2.45837 20.8359L3.58973 21.9679L5.89277 19.6647C7.44605 20.6935 9.55829 20.5248 10.9273 19.1561L13.19 16.8936L12.0584 15.7625L14.3209 13.4993Z" fill="currentColor" />
                                <path d="M21.6584 3.89991L20.527 2.76855L18.224 5.07183C16.6707 4.04295 14.5584 4.21239 13.1895 5.58039L10.9268 7.8436L16.5838 13.4999L18.8463 11.2372C20.215 9.86847 20.3847 7.75599 19.3548 6.20271L21.6584 3.89991Z" fill="currentColor" />
                            </svg>
                        </div>
                        <p className={styles.menuListItemText}>Integrations</p>
                    </li>
                    <li className={styles.menuListItem}>
                        <div className={styles.menuListItemIcon}>
                            <svg width="21" height="19" viewBox="0 0 21 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12.8123 7.36816C13.7788 7.36816 14.5623 8.15166 14.5623 9.11816V13.8672C14.5623 16.353 12.5471 18.3682 10.0613 18.3682C7.57547 18.3682 5.56028 16.353 5.56028 13.8672V9.11816C5.56028 8.15166 6.34378 7.36816 7.31028 7.36816H12.8123ZM5.18963 7.36722C4.84018 7.78996 4.61471 8.31896 4.56892 8.89856L4.56028 9.11816V13.8672C4.56028 14.7138 4.75154 15.5158 5.09322 16.2322C4.76412 16.3212 4.41734 16.3682 4.05959 16.3682C1.84977 16.3682 0.0583496 14.5768 0.0583496 12.367V9.11816C0.0583496 8.19996 0.76546 7.44696 1.66482 7.37396L1.80835 7.36816L5.18963 7.36722ZM14.9331 7.36722L18.3083 7.36816C19.2748 7.36816 20.0583 8.15166 20.0583 9.11816V12.3682C20.0583 14.5773 18.2675 16.3682 16.0583 16.3682C15.702 16.3682 15.3564 16.3216 15.0275 16.2341C15.3281 15.6062 15.5121 14.9134 15.5534 14.1826L15.5623 13.8672V9.11816C15.5623 8.45286 15.3261 7.84286 14.9331 7.36722ZM10.0583 0.368164C11.7153 0.368164 13.0583 1.71131 13.0583 3.36816C13.0583 5.02501 11.7153 6.36816 10.0583 6.36816C8.40145 6.36816 7.05835 5.02501 7.05835 3.36816C7.05835 1.71131 8.40145 0.368164 10.0583 0.368164ZM16.5583 1.36816C17.939 1.36816 19.0583 2.48745 19.0583 3.86816C19.0583 5.24887 17.939 6.36816 16.5583 6.36816C15.1776 6.36816 14.0583 5.24887 14.0583 3.86816C14.0583 2.48745 15.1776 1.36816 16.5583 1.36816ZM3.55835 1.36816C4.93906 1.36816 6.05835 2.48745 6.05835 3.86816C6.05835 5.24887 4.93906 6.36816 3.55835 6.36816C2.17764 6.36816 1.05835 5.24887 1.05835 3.86816C1.05835 2.48745 2.17764 1.36816 3.55835 1.36816Z" fill="currentColor" />
                            </svg>
                        </div>
                        <p className={styles.menuListItemText}>Teams</p>
                    </li>
                </ul>
                <ul className={styles.menuList}>
                    <li className={styles.menuListItem}>
                        <div className={styles.menuListItemIcon}>
                            <SettingsIcon />
                        </div>
                        <p className={styles.menuListItemText}>Settings</p>
                    </li>
                    <li className={styles.menuListItem}>
                        <div className={styles.menuListItemIcon}>
                            <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M11.0583 0.368164C4.98322 0.368164 0.0583496 5.29303 0.0583496 11.3682C0.0583496 17.4433 4.98322 22.3682 11.0583 22.3682C17.1335 22.3682 22.0583 17.4433 22.0583 11.3682C22.0583 5.29303 17.1335 0.368164 11.0583 0.368164ZM9.96498 7.63939C10.3722 7.40007 10.8509 7.31259 11.3165 7.39244C11.782 7.47229 12.2042 7.71432 12.5084 8.07565C12.8126 8.43699 12.979 8.89432 12.9783 9.36664L12.9783 9.36813C12.9783 9.83726 12.6132 10.3263 11.9236 10.7861C11.6093 10.9957 11.2878 11.1571 11.041 11.2668C10.919 11.321 10.8187 11.3611 10.7513 11.3868C10.7213 11.3982 10.6913 11.4092 10.6611 11.4198C10.1378 11.5948 9.85513 12.1608 10.0297 12.6844C10.2043 13.2083 10.7706 13.4915 11.2946 13.3168L11.4632 13.2557C11.5599 13.2189 11.694 13.1652 11.8532 13.0944C12.1689 12.9541 12.5974 12.7406 13.033 12.4502C13.8433 11.91 14.9779 10.8994 14.9783 9.36904C14.9796 8.4246 14.6467 7.51018 14.0384 6.78765C13.4301 6.06498 12.5856 5.58093 11.6546 5.42123C10.7235 5.26153 9.76602 5.43649 8.95162 5.91513C8.13721 6.39376 7.51848 7.14517 7.20501 8.03628C7.02174 8.55727 7.29551 9.12819 7.8165 9.31146C8.33749 9.49473 8.90841 9.22096 9.09168 8.69997C9.24841 8.25441 9.55778 7.87871 9.96498 7.63939ZM11.0583 15.3681C10.5061 15.3681 10.0583 15.8158 10.0583 16.3681C10.0583 16.9204 10.5061 17.3681 11.0583 17.3681H11.0683C11.6206 17.3681 12.0683 16.9204 12.0683 16.3681C12.0683 15.8158 11.6206 15.3681 11.0683 15.3681H11.0583Z" fill="currentColor" />
                            </svg>
                        </div>
                        <p className={styles.menuListItemText}>Help</p>
                    </li>
                    <li className={styles.menuListItem}>
                        <div className={styles.menuListItemIcon}>
                            <svg width="23" height="17" viewBox="0 0 23 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M11.2996 0.368164H5.81705C5.01209 0.368152 4.34772 0.368142 3.80652 0.412359C3.24443 0.458284 2.72772 0.556848 2.24239 0.804139C1.48974 1.18763 0.877818 1.79956 0.494325 2.5522C0.247034 3.03754 0.14847 3.55424 0.102545 4.11634C0.0583275 4.65753 0.0583377 5.32189 0.05835 6.12685V10.6095C0.0583377 11.4144 0.0583275 12.0788 0.102545 12.62C0.14847 13.1821 0.247034 13.6988 0.494325 14.1841C0.877818 14.9368 1.48974 15.5487 2.24239 15.9322C2.72772 16.1795 3.24443 16.278 3.80652 16.324C4.34772 16.3682 5.01208 16.3682 5.81705 16.3682H11.2996C12.1046 16.3682 12.769 16.3682 13.3102 16.324C13.8723 16.278 14.389 16.1795 14.8743 15.9322C15.627 15.5487 16.2389 14.9368 16.6224 14.1841C16.8697 13.6988 16.9682 13.1821 17.0142 12.62C17.0552 12.118 17.0581 11.5101 17.0583 10.7823L19.0119 12.7358C19.203 12.9271 19.3909 13.115 19.5556 13.2529C19.7026 13.3759 20.012 13.6226 20.4407 13.6564C20.9193 13.694 21.3871 13.5003 21.699 13.1352C21.9782 12.8082 22.0226 12.415 22.0395 12.2241C22.0584 12.0101 22.0584 11.7444 22.0584 11.474V5.26223C22.0584 4.99186 22.0584 4.72609 22.0395 4.51212C22.0226 4.32123 21.9782 3.92798 21.699 3.60103C21.3871 3.23592 20.9193 3.04216 20.4407 3.07983C20.012 3.11356 19.7026 3.36027 19.5556 3.48329C19.391 3.62117 19.2031 3.80909 19.0119 4.00029L17.0583 5.9539C17.0581 5.22616 17.0552 4.61828 17.0142 4.11634C16.9682 3.55424 16.8697 3.03754 16.6224 2.5522C16.2389 1.79956 15.627 1.18763 14.8743 0.804139C14.389 0.556848 13.8723 0.458284 13.3102 0.412359C12.769 0.368142 12.1046 0.368152 11.2996 0.368164Z" fill="currentColor" />
                            </svg>
                        </div>
                        <p className={styles.menuListItemText}>Training</p>
                    </li>
                    <li className={styles.menuListItem} style={{ cursor: "auto", paddingBlock: !isSidebarExpanded ? "3.6px" : undefined }}>
                        <UserPuck imageSrc={ProfilePic} aria-hidden="true"></UserPuck>
                        <p className={styles.menuListItemText}>John Snow</p>
                        <ChevronUpIcon className={styles.menuListItemChevron} />
                    </li>
                </ul>
            </div>
            <div className={styles.mainLayout}>
                <header className={styles.header} role="banner">
                    <Stack horizontal verticalAlign="center" horizontalAlign="space-between">
                        <div className={styles.headerTitleContainer}>
                            <div className={styles.headerIconContainer}>
                                <SVG svgName="live_virus" className={styles.headerIcon}/>
                            </div>
                            <h1 className={styles.headerTitle}>{isLiveAttack ? 'Live Attack!' : 'All is well'}</h1>
                            <p className={styles.headerSubtitle}>Your threat activity {format(new Date(), "eeee, MMMM d, yyyy")}</p>
                        </div>
                        <div className={styles.headerDataContainer}>
                            <ShowIf condition={isDefined(attackStartDate)}>
                                <svg className={styles.headerDataIcon} width="33" height="33" viewBox="0 0 33 33" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M16.0583 8.08919V16.0892L21.3917 18.7559M29.3917 16.0892C29.3917 23.453 23.4221 29.4225 16.0583 29.4225C8.69455 29.4225 2.72501 23.453 2.72501 16.0892C2.72501 8.7254 8.69455 2.75586 16.0583 2.75586C23.4221 2.75586 29.3917 8.7254 29.3917 16.0892Z" stroke="#5C5A73" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <div className={styles.headerDataBlock}>
                                    <span className={styles.headerDataTitle}>Attack Start</span>
                                    <p className={styles.headerDataContent}>{formattedStartDate}</p>
                                </div>
                                <div className={styles.headerDataBlock}>
                                    <span className={styles.headerDataTitle}>Time Active</span>
                                    <p className={styles.headerDataContent}>{attackDuration}</p>
                                </div>
                            </ShowIf>
                            <ShowIf condition={isDefined(riskScore)}>
                                <div className={styles.riskScoreContainer}>
                                    <SVG svgName="hacker"/>
                                    <p className={styles.riskScoreTitle}>Risk Score</p>
                                    <p className={styles.riskScoreContent}>{riskScore}</p>
                                </div>
                            </ShowIf>
                            <div className={styles.chatButtonContainer} role="button" tabIndex={0} aria-label="Chat">
                                <svg className={styles.chatButtonBadge} width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="7.05835" cy="7.36816" r="6" fill="#E87474" stroke="#201F27" stroke-width="2" />
                                </svg>
                                <svg className={styles.chatButton} width="30" height="29" viewBox="0 0 30 29" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke="#5C5A73" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12.3917 18.3685L8.29136 22.5201C7.71942 23.0992 7.43344 23.3887 7.18764 23.4091C6.97439 23.4269 6.76559 23.3411 6.62631 23.1787C6.46578 22.9914 6.46578 22.5845 6.46578 21.7705V19.6906C6.46578 18.9604 5.8678 18.4321 5.14531 18.3263V18.3263C3.39669 18.0701 2.0234 16.6968 1.76727 14.9482C1.72504 14.6599 1.72504 14.3158 1.72504 13.6277V7.43516C1.72504 5.19495 1.72504 4.07484 2.16101 3.21919C2.5445 2.46655 3.15643 1.85462 3.90907 1.47113C4.76472 1.03516 5.88483 1.03516 8.12504 1.03516H17.9917C20.2319 1.03516 21.352 1.03516 22.2077 1.47113C22.9603 1.85462 23.5722 2.46655 23.9557 3.21919C24.3917 4.07484 24.3917 5.19495 24.3917 7.43516V13.0352M24.3917 27.7018L21.4898 25.6843C21.0819 25.4007 20.878 25.2589 20.656 25.1584C20.459 25.0692 20.2518 25.0042 20.0391 24.965C19.7995 24.9209 19.5511 24.9209 19.0543 24.9209H16.6584C15.1649 24.9209 14.4182 24.9209 13.8477 24.6302C13.346 24.3746 12.938 23.9666 12.6824 23.4648C12.3917 22.8944 12.3917 22.1477 12.3917 20.6542V17.3018C12.3917 15.8084 12.3917 15.0616 12.6824 14.4912C12.938 13.9894 13.346 13.5815 13.8477 13.3258C14.4182 13.0352 15.1649 13.0352 16.6584 13.0352H24.125C25.6185 13.0352 26.3652 13.0352 26.9357 13.3258C27.4374 13.5815 27.8454 13.9894 28.1011 14.4912C28.3917 15.0616 28.3917 15.8083 28.3917 17.3018V20.9209C28.3917 22.1634 28.3917 22.7846 28.1887 23.2747C27.9181 23.9281 27.3989 24.4472 26.7455 24.7179C26.2555 24.9209 25.6342 24.9209 24.3917 24.9209V27.7018Z" />
                                </svg>
                            </div>
                        </div>
                    </Stack>
                </header>
                <Outlet />
            </div>
        </Stack>
    );
};

export default Layout;
